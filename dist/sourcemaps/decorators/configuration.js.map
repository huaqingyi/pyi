{"version":3,"sources":["decorators/configuration.ts"],"names":[],"mappings":";;AAAA,mCAAoC;AACpC,kCAAkC;AAElC,+BAAwC;AAoDxC;;GAEG;AACH,MAAsB,oBAAiC,SAAQ,cAAO;IAG3D,MAAM,CAAC,KAAK;QACf,OAAO,oBAAoB,CAAC;IAChC,CAAC;IAGM,KAAK,CAAC,QAAQ;QACjB,IAAI,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,EAAE;YAAE,MAAM,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,EAAE,CAAC;SAAE;QACjD,OAAO,MAAM,IAAI,CAAC;IACtB,CAAC;CACJ;AAZD,oDAYC;AAED,gDAAgD;AAChD,MAAsB,uBAAoC,SAAQ,cAAO;IAarE;QACI,KAAK,EAAE,CAAC;QACR,IAAI,CAAC,SAAS,GAAG,IAAI,CAAC;QACtB,IAAI,CAAC,mBAAmB,GAAG,KAAK,CAAC;QACjC,IAAI,CAAC,SAAS,GAAG,aAAO,CAAC;QACzB,IAAI,CAAC,OAAO,GAAG;YACX,GAAG,EAAE,aAAa;YAClB,MAAM,EAAE,EAAE,GAAG,EAAE,GAAG,EAAE,GAAG,IAAI;SAC9B,CAAC;IACN,CAAC;IAnBM,MAAM,CAAC,KAAK;QACf,OAAO,uBAAuB,CAAC;IACnC,CAAC;IAmBM,KAAK,CAAC,QAAQ;QACjB,IAAI,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,EAAE;YAAE,MAAM,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,EAAE,CAAC;SAAE;QACjD,OAAO,MAAM,IAAI,CAAC;IACtB,CAAC;CACJ;AA5BD,0DA4BC;AAED,SAAgB,aAAa,CAAc,MAAa;IACpD,MAAM,EAAE,KAAK,EAAE,GAAI,MAAc,CAAC;IAClC;;OAEG;IACH,IAAI,KAAK,IAAI,mBAAU,CAAC,KAAK,CAAC,EAAE;QAC5B,IACI,KAAK,EAAE,KAAK,oBAAoB;YAChC,KAAK,EAAE,KAAK,uBAAuB,EACrC;YACE,OAAO,MAAM,CAAC;SACjB;aAAM;YACH;;eAEG;YACH,OAAO,CAAC,MAAW,EAAE,GAAY,EAAE,EAAE;gBACjC,MAAM,CAAC,SAAS,CAAC,KAAK,GAAG,MAAM,CAAC;YACpC,CAAC,CAAC;SACL;KACJ;SAAM;QACH,OAAO,MAAM,CAAC;KACjB;AACL,CAAC;AAtBD,sCAsBC","file":"../../decorators/configuration.js","sourcesContent":["import { isFunction } from 'lodash';\nimport { PYICore } from '../core';\nimport { RoutingControllersOptions } from 'routing-controllers';\nimport { PYIDto, PYIGDto } from './dto';\nimport { SetOption } from 'cookies';\nimport { stores } from 'koa-session';\nimport { Context } from 'vm';\nimport { Session } from 'inspector';\nimport Keygrip from 'keygrip';\nimport { Options } from 'koa-jwt';\nimport { SignOptions, Secret } from 'jsonwebtoken';\n\n// tslint:disable-next-line:no-empty-interface\nexport interface SessionOption extends Omit<SetOption, 'maxAge'> {\n    keys?: Keygrip | string[];\n    key: string;\n    maxAge?: number | 'session';\n    encode?: (obj: object) => string;\n    decode?: (str: string) => object;\n    genid?: () => string;\n    rolling?: boolean;\n    renew?: boolean;\n    store?: stores;\n    ContextStore?: new (ctx: Context) => stores;\n    prefix?: string;\n    valid?(ctx: Context, session: Partial<Session>): void;\n    beforeSave?(ctx: Context, session: Session): void;\n}\n\nexport interface JWTOptions {\n    secret: Secret;\n    path: RegExp[];\n    token?: SignOptions;\n    key?: string;\n    tokenKey?: string;\n    passthrough?: boolean;\n    cookie?: string;\n    debug?: boolean;\n    audience?: string | string[];\n    issuer?: string;\n    algorithms?: string[];\n    errno?: number;\n    errmsg?: string;\n    getToken?(ctx: Context, opts: Options): string;\n    isRevoked?(ctx: Context, decodedToken: object, token: string): Promise<boolean>;\n}\n\nexport interface PYIApplicationConfiguration extends RoutingControllersOptions {\n    [x: string]: any;\n    enableDto?: boolean;\n    globalDto?: PYIDto;\n    session?: SessionOption;\n    jwt?: JWTOptions;\n}\n\n/**\n * Component base\n */\nexport abstract class PYIAutoConfiguration<Props = {}> extends PYICore {\n    [x: string]: any;\n    public static _pyi: () => any;\n    public static _root() {\n        return PYIAutoConfiguration;\n    }\n\n    public props?: Props;\n    public async _runtime() {\n        if (this[this.mode]) { await this[this.mode](); }\n        return await this;\n    }\n}\n\n// tslint:disable-next-line:max-classes-per-file\nexport abstract class PYIAutoAppConfiguration<Props = {}> extends PYICore implements PYIApplicationConfiguration {\n    [x: string]: any;\n    public static _pyi: () => any;\n    public static _root() {\n        return PYIAutoAppConfiguration;\n    }\n\n    public props?: Props;\n\n    public enableDto: boolean;\n    public globalDto: any & PYIDto;\n    public session: SessionOption;\n    public jwt?: JWTOptions;\n    constructor() {\n        super();\n        this.enableDto = true;\n        this.defaultErrorHandler = false;\n        this.globalDto = PYIGDto;\n        this.session = {\n            key: 'pyi:session',\n            maxAge: 60 * 60 * 24 * 1000\n        };\n    }\n\n    public async _runtime() {\n        if (this[this.mode]) { await this[this.mode](); }\n        return await this;\n    }\n}\n\nexport function Configuration<Props = any>(config: Props): any {\n    const { _root } = (config as any);\n    /**\n     * 如果是直接修饰类\n     */\n    if (_root && isFunction(_root)) {\n        if (\n            _root() === PYIAutoConfiguration ||\n            _root() === PYIAutoAppConfiguration\n        ) {\n            return config;\n        } else {\n            /**\n             * 带参数的修饰\n             */\n            return (target: any, key?: string) => {\n                target.prototype.props = config;\n            };\n        }\n    } else {\n        return config;\n    }\n}\n"]}