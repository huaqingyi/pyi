{"version":3,"sources":["decorators/component.ts"],"names":[],"mappings":"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","file":"../../decorators/component.js","sourcesContent":["import { PYICore, PYIApp, PYICoreClass } from '../core';\nimport { isFunction } from 'lodash';\nimport { PYIConfiguration, PYIAppConfiguration } from './configuration';\n\nexport function Component<VC extends PYICoreClass<PYIComponent>>(tprops: VC): VC;\nexport function Component<Props = any>(\n    props: Props & any\n): <VC extends PYICoreClass<PYIComponent>>(target: VC) => VC;\nexport function Component(props: any | PYIApp) {\n    if (props._base && props._base() === PYIComponent) {\n        return props;\n    }\n    return (target: PYIApp) => {\n        target.prototype.props = props;\n        return target;\n    };\n}\n\nexport enum ComponentWiredType {\n    AUTOCONNECT = 'autoconnect',\n    AUTOWIRED = 'autowired'\n}\n\nexport function auto(type: string) {\n    return (target: any, key: string) => {\n        /**\n         * 容错\n         */\n        if (!target.constructor._pyi) { target.constructor._pyi = () => ({}); }\n        /**\n         * 获取注入类\n         */\n        const params = Reflect.getMetadata('design:type', target, key);\n        /**\n         * 是否嵌套依赖\n         */\n        if (!params._pyi || !params._pyi().autowired) {\n            const { props } = params.prototype;\n            let instance;\n            if (\n                (params._base && isFunction(params._base) && params._base() === PYIConfiguration) ||\n                (params._base && isFunction(params._base) && params._base() === PYIAppConfiguration)\n            ) {\n                (async () => {\n                    switch (type) {\n                        case ComponentWiredType.AUTOWIRED:\n                            instance = await params._pyiruntime(props);\n                            break;\n                        case ComponentWiredType.AUTOCONNECT:\n                            instance = await params._pyiconnect(props);\n                            break;\n                        default: return target;\n                    }\n                    instance = await instance._pyiruntime();\n                    target.constructor.prototype[key] = await instance;\n                })();\n            } else {\n                switch (type) {\n                    case ComponentWiredType.AUTOWIRED:\n                        instance = params._pyiruntime();\n                        break;\n                    case ComponentWiredType.AUTOCONNECT:\n                        instance = params._pyiconnect();\n                        break;\n                    default: return target;\n                }\n                target.constructor.prototype[key] = instance;\n            }\n        } else {\n            /**\n             * 嵌套依赖\n             */\n            const _pyi = target.constructor._pyi();\n            if (!_pyi.autowired) {\n                target.constructor._pyi = () => ({\n                    ..._pyi,\n                    autowired: [\n                        ...(_pyi.autowired || []),\n                        key\n                    ]\n                });\n            }\n        }\n        return target.constructor.prototype[key];\n    };\n}\n\nexport function autowired(target: any, key: string) {\n    return auto(ComponentWiredType.AUTOWIRED)(target, key);\n}\n\nexport function autoconnect(target: any, key: string) {\n    return auto(ComponentWiredType.AUTOCONNECT)(target, key);\n}\n\nexport class PYIComponent<Props = any> extends PYICore {\n    public static _base(): PYIApp {\n        return PYIComponent;\n    }\n\n    public props!: Props;\n}\n"]}