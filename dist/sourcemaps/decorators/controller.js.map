{"version":3,"sources":["decorators/controller.ts"],"names":[],"mappings":"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","file":"../../decorators/controller.js","sourcesContent":["import { isFunction, map } from 'lodash';\nexport * from 'routing-controllers';\nimport { JsonController, Method, Middleware as RMiddleware, Interceptor as RInterceptor } from 'routing-controllers';\nimport { ActionType } from 'routing-controllers/metadata/types/ActionType';\nimport { PYIBase } from '../core/pyi.base';\nimport { PYIVo } from './impl';\n\n/**\n * Controller ================================\n */\nexport enum RequestMappingMethod {\n    GET = 'GET',\n    POST = 'POST',\n    DELETE = 'DELETE',\n    PUT = 'PUT',\n    PATCH = 'PATCH'\n}\n\nexport interface ControllerConfiguration {\n    prefix?: string;\n}\n\nexport interface ControllerRequestConfiguration extends ControllerConfiguration {\n    prefix?: string;\n    methods?: string[] | ActionType[];\n}\n\nexport abstract class PYIController extends PYIBase {\n    public static _pyi: () => any;\n    public static _extends() {\n        return PYIController;\n    }\n\n    public static Execption<UseParentClass = any, UsePYIVo = PYIVo>(\n        execption: UseParentClass & any, Vo: UsePYIVo & any\n    ): any {\n        execption.bind(PYIController._this);\n        const exinstance = new execption();\n        const ex: Promise<any> = exinstance.throws();\n        return ex.then((resp) => {\n            return new Vo(resp);\n        }).catch((err) => {\n            const { errno, errmsg } = exinstance;\n            return (new Vo()).throws(err, errno, errmsg);\n        });\n        // return PYIController._this.ctx.vo = vo;\n    }\n\n    constructor(...props: any) { super(); }\n}\n\n/**\n * Extends for routing-controllers JsonController\n * @param config extends routing-controllers config(继承于 routing-controllers 参数)\n */\nexport function Controller<Props = ControllerConfiguration | PYIController>(config: Props): any {\n    if (isFunction(config)) {\n        JsonController(undefined)(config as any);\n    } else {\n        return (target: any, key?: string) => {\n            const { prefix } = config as ControllerConfiguration;\n            JsonController(prefix ? prefix : undefined)(target);\n        };\n    }\n}\n\n/**\n * Extends for routing-controllers ActionType\n * @param config extends routing-controllers config(继承于 routing-controllers 参数)\n */\nexport function RequestMapping(config: ControllerRequestConfiguration | PYIController, key?: string): any {\n    if (key) {\n        map(RequestMappingMethod, (m) => {\n            Method(m as any, undefined)(config, key);\n        });\n    } else {\n        // tslint:disable-next-line:no-shadowed-variable\n        return (target: any, key: string) => {\n            const Vo = Reflect.getMetadata('design:returntype', target, key);\n            // console.log(vo);\n            const { prefix, methods } = config as ControllerRequestConfiguration;\n            map(methods && methods.length > 0 ? methods : RequestMappingMethod, (m) => {\n                Method(m as ActionType, prefix)(target, key);\n            });\n        };\n    }\n}\n\n/**\n * Middleware ===============================================\n */\n\n// tslint:disable-next-line:max-classes-per-file\nexport abstract class PYIMiddleware extends PYIBase {\n    public static _pyi: () => any;\n    public static _extends() {\n        return PYIMiddleware;\n    }\n\n    constructor(...props: any) { super(); }\n}\n\n/**\n * Extends for routing-controllers middleware\n * @param options extends routing-controllers middleware\n */\nexport function Middleware(\n    options: {\n        type: 'after' | 'before';\n        priority?: number;\n    }\n) {\n    return (target: any, key?: string) => {\n        RMiddleware(options)(target);\n    };\n}\n\n// tslint:disable-next-line:max-classes-per-file\nexport abstract class PYIInterceptor extends PYIBase {\n    public static _pyi: () => any;\n    public static _extends() {\n        return PYIInterceptor;\n    }\n\n    constructor(...props: any) { super(); }\n}\n\n/**\n * Extends for routing-controllers Interceptor\n * @param options extends routing-controllers Interceptor\n */\nexport function Interceptor(options?: { priority?: number; }) {\n    return (target: any, key?: string) => {\n        RInterceptor(options)(target);\n    };\n}\n"]}