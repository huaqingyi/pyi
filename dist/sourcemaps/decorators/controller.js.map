{"version":3,"sources":["decorators/controller.ts"],"names":[],"mappings":"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","file":"../../decorators/controller.js","sourcesContent":["import { PYICore, PYIApp, PYICoreClass } from '../core';\n\nimport {\n    JsonController, Method,\n    Middleware as RMiddleware,\n    Interceptor as RInterceptor,\n} from '../extends';\nimport { ActionType } from 'routing-controllers/metadata/types/ActionType';\nimport { map } from 'lodash';\nimport { PYIThrows } from './execption';\n\nexport * from '../extends';\n\n/**\n * Controller ================================\n */\nexport enum RequestMappingMethod {\n    GET = 'GET',\n    POST = 'POST',\n    DELETE = 'DELETE',\n    PUT = 'PUT',\n    PATCH = 'PATCH',\n    CONNECT = 'CONNECT',\n    CHECKOUT = 'CHECKOUT',\n    COPY = 'COPY',\n    HEAD = 'HEAD',\n    LOCK = 'LOCK',\n    MERGE = 'MERGE',\n    MKACTIVITY = 'MKACTIVITY',\n    MKCOL = 'MKCOL',\n    MOVE = 'MOVE',\n    M_SEARCH = 'm-search',\n    NOTIFY = 'NOTIFY',\n    OPTIONS = 'OPTIONS',\n    PROPFIND = 'PROPFIND',\n    PROPPATCH = 'PROPPATCH',\n    PURGE = 'PURGE',\n    REPORT = 'REPORT',\n    SEARCH = 'SEARCH',\n    SUBSCRIBE = 'SUBSCRIBE',\n    TRACE = 'TRACE',\n    UNLOCK = 'UNLOCK',\n    UNSUBSCRIBE = 'UNSUBSCRIBE'\n}\n\nexport interface ControllerConfiguration {\n    prefix?: string;\n}\n\nexport interface ControllerRequestConfiguration extends ControllerConfiguration {\n    prefix?: string;\n    methods?: string[] | RequestMappingMethod[];\n}\n\nexport function Controller<VC extends PYICoreClass<PYIController>>(tprops: VC): VC;\nexport function Controller<Props = any>(\n    props: Props & any\n): <VC extends PYICoreClass<PYIController>>(target: VC) => VC;\nexport function Controller<Props extends any>(props: Props) {\n    if (props._base && props._base() === PYIController) {\n        JsonController(undefined)(props as any);\n        return props;\n    } else {\n        return (target: PYIApp) => {\n            target.prototype.props = props;\n            const { prefix } = props;\n            JsonController(prefix ? prefix : undefined)(target as any);\n            return target;\n        };\n    }\n}\n\nexport class PYIController<Props = any> extends PYICore {\n    public static _base(): PYIApp {\n        return PYIController;\n    }\n\n    public props!: Props;\n}\n\nexport function RequestMapping(config: ControllerRequestConfiguration | PYIController, key?: string): any {\n    if (key) {\n        map(RequestMappingMethod, (m) => {\n            Method(m as any, undefined)(config, key);\n        });\n    } else {\n        // tslint:disable-next-line:no-shadowed-variable\n        return (target: any, key: string) => {\n            const { prefix, methods } = config as ControllerRequestConfiguration;\n            map(methods && methods.length > 0 ? methods : RequestMappingMethod, (m) => {\n                Method(m as ActionType, prefix)(target, key);\n            });\n        };\n    }\n}\n\nexport interface PYIMiddlewareProps {\n    type: 'after' | 'before';\n    priority?: number;\n}\n\nexport function Middleware<VC extends PYICoreClass<PYIMiddleware>>(tprops: VC): VC;\nexport function Middleware<Props = PYIMiddlewareProps>(\n    props: Props & PYIMiddlewareProps\n): <VC extends PYICoreClass<PYIMiddleware>>(target: VC) => VC;\nexport function Middleware<Props extends any>(props: Props) {\n    if (props._base && props._base() === PYIMiddleware) {\n        props.prototype.props = { type: 'before' };\n        RMiddleware({ type: 'before' })(props);\n        return props;\n    } else {\n        return (target: PYIApp) => {\n            target.prototype.props = props;\n            RMiddleware(props as any)(target);\n            return target;\n        };\n    }\n}\n\nexport class PYIMiddleware<Props = any> extends PYICore {\n    public static _base(): PYIApp {\n        return PYIMiddleware;\n    }\n\n    public props!: Props;\n}\n\nexport interface PYIInterceptorProps {\n    priority?: number;\n}\n\nexport function Interceptor<VC extends PYICoreClass<PYIInterceptor>>(tprops: VC): VC;\nexport function Interceptor<Props = PYIInterceptorProps>(\n    props: Props & PYIInterceptorProps\n): <VC extends PYICoreClass<PYIInterceptor>>(target: VC) => VC;\nexport function Interceptor<Props extends any>(props: Props) {\n    if (props._base && props._base() === PYIInterceptor) {\n        props.prototype.props = {};\n        RInterceptor()(props);\n        return props;\n    } else {\n        return (target: PYIApp) => {\n            target.prototype.props = props;\n            RInterceptor(props)(target);\n            return target;\n        };\n    }\n}\n\nexport class PYIInterceptor<Props = any> extends PYICore {\n    public static _base(): PYIApp {\n        return PYIInterceptor;\n    }\n\n    public props!: Props;\n}\n"]}